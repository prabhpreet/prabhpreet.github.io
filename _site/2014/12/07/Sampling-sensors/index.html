<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>Sampling sensors &#8211; Prabhpreet Singh Dua</title>
<meta name="description" content="">
<meta name="keywords" content="matlab,, testing,, sensors">


<meta property="og:locale" content="en_US">
<meta property="og:title" content="Sampling sensors &#8211; Prabhpreet Singh Dua">
<meta property="og:description" content="I am currently working on a robotics project and it required a bit of quick testing. The quickest way to get a readin...">
<meta property="og:url" content="http://prabhpreet.github.io/2014/12/07/Sampling-sensors/">
<meta property="og:site_name" content="Prabhpreet Singh Dua">


<link href="http://prabhpreet.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Prabhpreet Singh Dua Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Type -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Crimson+Text:400,400italic,700,700italic" rel='stylesheet' type='text/css' />
<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="http://prabhpreet.github.io/assets/css/entypo.css" media="all">

<!-- In order to use Calendas Plus, you must first purchase it. Then, create a font-face package using FontSquirrel.
<link rel='stylesheet' href='http://prabhpreet.github.io/assets/cal.css' media='all' />
-->



<!-- For all browsers -->
<link rel="stylesheet" href="http://prabhpreet.github.io/assets/css/i.css">

<!-- Fresh Squeezed jQuery -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://prabhpreet.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://prabhpreet.github.io/favicon.ico">

<div id="bump">
  <body class="">
    <header class="site-header">
      <div class="wrap">
        <hgroup>
          <!--<h1><a href="/">Prabhpreet Singh Dua</a></h1> -->
        </hgroup>
        <a href="#nav" class="menu"><span class='icons'>☰</span></a>
        <nav role="navigation">
          <ul>
            <li>
              <a href="/" title="Prabhpreet Singh Dua">Home</a>
            </li>
            
            
                <li><a href="http://facebook.com/prabhpreet.dua" target="_blank">Facebook</a></li>
            
                <li><a href="https://github.com/prabhpreet" target="_blank">Github</a></li>
            
                <li><a href="https://www.linkedin.com/profile/view?id=216363808" target="_blank">LinkedIn</a></li>
            
                <li><a href="http://prabhpreet.github.io/resume.pdf" >CV</a></li>
            

          </ul>
        </nav>
      </div>
    </header>


<section class="article">


  <div class="overlay"></div>
  <div class="featured-image" style="background-image: url(http://prabhpreet.github.io/images/typewriter.jpg)"></div>



      <article class="wrap post">
        <header class="post-header">
          <hgroup>
            <h1>Sampling sensors</h1>
            <p class="date">Dec 07, 2014</p>
            <p class="intro"></p>
          </hgroup>
        </header>

        <p>I am currently working on a robotics project and it required a bit of quick testing. The quickest way to get a reading, other than the LCD was UART + a Matlab script. I wrote my own MATLAB script, but it required some obscure functions to get it working.</p>

<p>So I thought I’ll share the important tidbits.</p>

<h3 id="the-serial-object">The serial object</h3>

<p>It’s kind of like the file pointer data structure in C. It will store the port info, but you’ll have to use <code>fopen</code>, <code>fgets</code> and <code>fclose</code> like manipulating files in C. Actually, the port data has been abstracted to the file. However, <code>fclose</code> is a big deal if you want other programs (such as a code uploader) to access your port.</p>

<pre><code class="language-matlab">s = serial('COM3') % COM3 is a port. Put whatever port your connected to!

set(s,'BaudRate', 115200); %Set your baud rate!
s.InputBufferSize = 5000; %Set the input buffer size (how much data can be stored)

fopen(s);

... %Other code omitted

while(1) %Infinite loop!
	if s.BytesAvailable &gt; 0 % To avoid timeout and other weird things
		str = fgets(s);
		...
	end
end
fclose(s); %Now you can access the object
</code></pre>

<h3 id="exceptionerror-handling">Exception/Error handling</h3>

<p>You’ll need this part because you want to close your port and let other programs access it in case something bad happens.</p>

<pre><code class="language-matlab">try
... %Your code here
catch err %Catch the damn problem
fclose(s);
end;
</code></pre>

<h3 id="plotting">Plotting</h3>

<p>Here you can plot as usual as except you’ll have to use <code>drawnow</code> to plot your data immediately and <code>hold on</code> if you’re going to add data to the existing plot.</p>

<pre><code class="language-matlab">figure(1);
hold on;
...
while(1)
	...
	plot(A);
	drawnow;
end
</code></pre>

<h3 id="string-manipulation">String manipulation</h3>

<p>Here I’ve used <code>sscanf</code> to manipulate the string. I think there is also a direct function to get both getting a line and scanning done at the same time. You can look up the usage easily. The code basically returns a column vector according to the format specified using C’s format specifiers (but look it up, to make sure!).</p>

<p>My data was of a white line sensor and I was getting it’s left, middle and right values hence the <code>L:%d M:%d R:%d</code>.</p>

<pre><code class="language-matlab">A = sscanf(str, 'L:%d M:%d R:%d');
</code></pre>

<h3 id="all-the-code">All the code</h3>

<p>Here it is, in all it’s glory:
``` matlab 
clear all;
close all;</p>

<p>figure(1);
delay = 0.5;</p>

<p>s = serial(‘COM3’);</p>

<p>set(s,’BaudRate’, 115200);
s.InputBufferSize = 5000;</p>

<p>fopen(s);</p>

<p>input(‘Ready?’);</p>

<p>try
A = [0;0;0];</p>

<p>while(1)
    if s.BytesAvailable &gt; 0
    str = fgets(s);
    A = sscanf(str, ‘L:%d M:%d R:%d’);
    bar(A)
    axis([0 4 0 255]);
    drawnow
    A = [0;0;0];</p>

<pre><code>end end; fclose(s); catch err
fclose(s); end; ``` 
</code></pre>


      <a class="share" href="https://twitter.com/intent/tweet?text=&quot;Sampling sensors&quot;%20/2014/12/07/Sampling-sensors/%20via%20&#64;prabhpreetD" data-dnt="true">Share</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

      


      </article>

    </section>
</div>

<div class="push"></div>
  <footer>
    <aside class="wrap">
      <ol class="prev-posts">
        <p class="list-title">Recent Posts</p>
         <!-- for1 -->
            <li>
              <span class="recent-title"><a href="http://prabhpreet.github.io/2014/12/07/Sampling-sensors/" title="Sampling sensors">Sampling sensors </a></span>
              <span class="date">Dec 07, 2014</span>
            </li>
        
      </ol>

      <div class="social">
        <ul>
            <li><a id="mail" href="mailto:"><span class="foot-link">Contact Me</span></a></li>

            
            <li><a id="twit" href="http://twitter.com/prabhpreetD" target="_blank"><span class="foot-link">@prabhpreetD</span></a></li>
            


            
        </ul>
    </div>
    </aside>
    <small>&copy; 2016 Prabhpreet Singh Dua. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://jekyll.gtat.me/about">Balzac</a> theme.</small>
  </footer>

  <!-- If they're out, get some from the cellar -->
  <script>window.jQuery || document.write('<script src="http://prabhpreet.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
  <script src="http://prabhpreet.github.io/assets/js/retina.min.js"></script>

  <!-- Custom JS -->
  <script src="http://prabhpreet.github.io/assets/js/scripts.js"></script>


  </body>
</html>

