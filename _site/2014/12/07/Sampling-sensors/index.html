<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>Sampling sensors &#8211; Prabhpreet Singh Dua</title>
<meta name="description" content="">
<meta name="keywords" content="matlab,, testing,, sensors">


<meta property="og:locale" content="en_US">
<meta property="og:title" content="Sampling sensors &#8211; Prabhpreet Singh Dua">
<meta property="og:description" content="I am currently working on a robotics project and it required a bit of quick testing. The quickest way to get a readin...">
<meta property="og:url" content="http://localhost:4000//2014/12/07/Sampling-sensors/">
<meta property="og:site_name" content="Prabhpreet Singh Dua">


<link href="http://localhost:4000//feed.xml" type="application/atom+xml" rel="alternate" title="Prabhpreet Singh Dua Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Type -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Crimson+Text:400,400italic,700,700italic" rel='stylesheet' type='text/css' />
<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="http://localhost:4000//assets/css/entypo.css" media="all">

<!-- In order to use Calendas Plus, you must first purchase it. Then, create a font-face package using FontSquirrel.
<link rel='stylesheet' href='http://localhost:4000//assets/cal.css' media='all' />
-->



<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000//assets/css/i.css">

<!-- Fresh Squeezed jQuery -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://localhost:4000//assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000//favicon.ico">

<div id="bump">
  <body class="">
    <header class="site-header">
      <div class="wrap">
        <hgroup>
          <!--<h1><a href="/">Prabhpreet Singh Dua</a></h1> -->
        </hgroup>
        <a href="#nav" class="menu"><span class='icons'>☰</span></a>
        <nav role="navigation">
          <ul>
            <li>
              <a href="/" title="Prabhpreet Singh Dua">Home</a>
            </li>
            
            
                <li><a href="http://facebook.com/prabhpreet.dua" target="_blank">Facebook</a></li>
            
                <li><a href="https://github.com/prabhpreet" target="_blank">Github</a></li>
            
                <li><a href="https://www.linkedin.com/profile/view?id=216363808" target="_blank">LinkedIn</a></li>
            
                <li><a href="http://localhost:4000//150511_Resume_PrabhpreetSinghDua_Online.pdf" >CV</a></li>
            

          </ul>
        </nav>
      </div>
    </header>


<section class="article">


  <div class="overlay"></div>
  <div class="featured-image" style="background-image: url(http://localhost:4000//images/typewriter.jpg)"></div>



      <article class="wrap post">
        <header class="post-header">
          <hgroup>
            <h1>Sampling sensors</h1>
            <p class="date">Dec 07, 2014</p>
            <p class="intro"></p>
          </hgroup>
        </header>

        <p>I am currently working on a robotics project and it required a bit of quick testing. The quickest way to get a reading, other than the LCD was UART + a Matlab script. I wrote my own MATLAB script, but it required some obscure functions to get it working.</p>

<p>So I thought I’ll share the important tidbits.</p>

<h3 id="the-serial-object">The serial object</h3>

<p>It’s kind of like the file pointer data structure in C. It will store the port info, but you’ll have to use <code>fopen</code>, <code>fgets</code> and <code>fclose</code> like manipulating files in C. Actually, the port data has been abstracted to the file. However, <code>fclose</code> is a big deal if you want other programs (such as a code uploader) to access your port.</p>

<div class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">s</span> <span class="p">=</span> <span class="n">serial</span><span class="p">(</span><span class="s">&#39;COM3&#39;</span><span class="p">)</span> <span class="c">% COM3 is a port. Put whatever port your connected to!</span>

<span class="n">set</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&#39;BaudRate&#39;</span><span class="p">,</span> <span class="mi">115200</span><span class="p">);</span> <span class="c">%Set your baud rate!</span>
<span class="n">s</span><span class="p">.</span><span class="n">InputBufferSize</span> <span class="p">=</span> <span class="mi">5000</span><span class="p">;</span> <span class="c">%Set the input buffer size (how much data can be stored)</span>

<span class="n">fopen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>

<span class="c">... %Other code omitted</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">%Infinite loop!</span>
	<span class="k">if</span> <span class="n">s</span><span class="p">.</span><span class="n">BytesAvailable</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="c">% To avoid timeout and other weird things</span>
		<span class="n">str</span> <span class="p">=</span> <span class="n">fgets</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
		<span class="c">...</span>
	<span class="k">end</span>
<span class="k">end</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="c">%Now you can access the object</span></code></pre></div>

<h3 id="exceptionerror-handling">Exception/Error handling</h3>

<p>You’ll need this part because you want to close your port and let other programs access it in case something bad happens.</p>

<div class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="k">try</span>
<span class="c">... %Your code here</span>
<span class="k">catch</span> <span class="n">err</span> <span class="c">%Catch the damn problem</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span></code></pre></div>

<h3 id="plotting">Plotting</h3>

<p>Here you can plot as usual as except you’ll have to use <code>drawnow</code> to plot your data immediately and <code>hold on</code> if you’re going to add data to the existing plot.</p>

<div class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">hold</span> <span class="n">on</span><span class="p">;</span>
<span class="c">...</span>
<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="c">...</span>
	<span class="n">plot</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
	<span class="n">drawnow</span><span class="p">;</span>
<span class="k">end</span></code></pre></div>

<h3 id="string-manipulation">String manipulation</h3>

<p>Here I’ve used <code>sscanf</code> to manipulate the string. I think there is also a direct function to get both getting a line and scanning done at the same time. You can look up the usage easily. The code basically returns a column vector according to the format specified using C’s format specifiers (but look it up, to make sure!).</p>

<p>My data was of a white line sensor and I was getting it’s left, middle and right values hence the <code>L:%d M:%d R:%d</code>.</p>

<div class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">A</span> <span class="p">=</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s">&#39;L:%d M:%d R:%d&#39;</span><span class="p">);</span></code></pre></div>

<h3 id="all-the-code">All the code</h3>

<p>Here it is, in all it’s glory:</p>

<div class="highlight"><pre><code class="language-matlab" data-lang="matlab"><span class="n">clear</span> <span class="n">all</span><span class="p">;</span>
<span class="n">close</span> <span class="n">all</span><span class="p">;</span>

<span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">delay</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span>

<span class="n">s</span> <span class="p">=</span> <span class="n">serial</span><span class="p">(</span><span class="s">&#39;COM3&#39;</span><span class="p">);</span>

<span class="n">set</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&#39;BaudRate&#39;</span><span class="p">,</span> <span class="mi">115200</span><span class="p">);</span>
<span class="n">s</span><span class="p">.</span><span class="n">InputBufferSize</span> <span class="p">=</span> <span class="mi">5000</span><span class="p">;</span>

<span class="n">fopen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>

<span class="n">input</span><span class="p">(</span><span class="s">&#39;Ready?&#39;</span><span class="p">);</span>

<span class="k">try</span>
<span class="n">A</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">.</span><span class="n">BytesAvailable</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">str</span> <span class="p">=</span> <span class="n">fgets</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">A</span> <span class="p">=</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s">&#39;L:%d M:%d R:%d&#39;</span><span class="p">);</span>
    <span class="n">bar</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">([</span><span class="mi">0</span> <span class="mi">4</span> <span class="mi">0</span> <span class="mi">255</span><span class="p">]);</span>
    <span class="n">drawnow</span>
    <span class="n">A</span> <span class="p">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">];</span>
    
    <span class="k">end</span>
<span class="k">end</span><span class="p">;</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="k">catch</span> <span class="n">err</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="k">end</span><span class="p">;</span></code></pre></div>


      <a class="share" href="https://twitter.com/intent/tweet?text=&quot;Sampling sensors&quot;%20/2014/12/07/Sampling-sensors/%20via%20&#64;prabhpreetD" data-dnt="true">Share</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

      


      </article>

    </section>
</div>

<div class="push"></div>
  <footer>
    <aside class="wrap">
      <ol class="prev-posts">
        <p class="list-title">Recent Posts</p>
         <!-- for1 -->
            <li>
              <span class="recent-title"><a href="http://localhost:4000//2014/12/07/Sampling-sensors/" title="Sampling sensors">Sampling sensors </a></span>
              <span class="date">Dec 07, 2014</span>
            </li>
        
      </ol>

      <div class="social">
        <ul>
            <li><a id="mail" href="mailto:"><span class="foot-link">Contact Me</span></a></li>

            
            <li><a id="twit" href="http://twitter.com/prabhpreetD" target="_blank"><span class="foot-link">@prabhpreetD</span></a></li>
            


            
        </ul>
    </div>
    </aside>
    <small>&copy; 2015 Prabhpreet Singh Dua. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://jekyll.gtat.me/about">Balzac</a> theme.</small>
  </footer>

  <!-- If they're out, get some from the cellar -->
  <script>window.jQuery || document.write('<script src="http://localhost:4000//assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
  <script src="http://localhost:4000//assets/js/retina.min.js"></script>

  <!-- Custom JS -->
  <script src="http://localhost:4000//assets/js/scripts.js"></script>


  </body>
</html>

